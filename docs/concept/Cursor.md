---
title: 游标
author: T8840
date: '2023-01-15'
---

## 游标定义
所谓的游标，也就是能够对结果集中的每一条记录进行定位，并对指向的记录中的数据进行操作的数据结构。  

虽然我们也可以通过筛选条件WHERE和HAVING，或者是限定返回记录的关键字LIMIT返回
一条记录，但是，却无法在结果集中像指针一样，向前定位一条记录、向后定位一条记录，
或者是随意定位到某一条记录，并对记录的数据进行处理。这个时候，就可以用到游标。

## 游标的使用步骤

游标只能在存储程序内使用，存储程序包括存储过程和存储函数。

创建存储函数的语法是：
```sql
CREATE FUNCTION 函数名称 （参数）RETURNS 数据类型 程序体

```
存储函数与存储过程很像，但有几个不同点：
1. 存储函数必须返回一个值或者数据表，存储过程可以不返回。
2. 存储过程可以通过CALL语句调用，存储函数不可以。
3. 存储函数可以放在查询语句中使用，存储过程不行。
4. 存储过程的功能更加强大，包括能够执行对表的操作（比如创建表，删除表等）和事务操作，这些功能是存储函数不具备的。

在使用游标的时候，主要有4个步骤:
1. 定义游标。
```sql
DECLARE 游标名 CURSOR FOR 查询语句
```
2. 打开游标
OPEN 游标名称；
打开游标之后，系统会为游标准备好查询的结果集，为后面游标的逐条读取结果集中的记录做准备。

3. 从游标的数据结果集中读取数据  
语法结构是这样的：
```sql
FETCH 游标名 INTO 变量列表；

```
4. 关闭游标
CLOSE 游标名

用完游标之后，你一定要记住及时关闭游标。因为游标会占用系统资源，如果不及时关闭，游标会一直保持到存储过程结束，影响系统运行的效率。而关闭游标的操作，会释放游标占用的系统资源。